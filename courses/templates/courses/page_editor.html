{% extends 'pages/base.html' %}
{% load static %}

{% block content %}
    <style>
        #sidebar {
            position: sticky;
            top: 80px;
            height: calc(100vh - 120px);
        }

        #section-list .list-group-item {
            cursor: pointer;
            transition: background-color 0.15s ease;
        }

        #section-list .list-group-item:hover {
            background-color: #f6f8fa;
        }

        .section-link {
            color: #0d6efd;
            font-weight: 500;
        }

        .section-link:hover {
            color: #0a58ca;
        }
    </style>

    <div class="row mt-4 d-flex justify-content-center">
        <div id="main-container" class="col-12 col-xl-9">
            <div id="task-list" class="bg-white p-3 rounded shadow-sm" style="min-height: 400px;"></div>

            <button id="add-task-btn" class="btn btn-outline-primary w-100 p-4 fs-5 fw-bold shadow-sm border-primary my-3">
                <i class="bi bi-plus-circle me-2"></i>
                Добавить задание
            </button>
        </div>

        <!-- Боковая панель -->
        <div id="sidebar" class="col-12 col-xl-3 mb-4 mb-xl-0 d-flex flex-column">
            <div class="card shadow-sm border-0 rounded flex-grow-1 overflow-hidden">
                <ul id="section-list" class="list-group list-group-flush overflow-y-auto" style="max-height: 100%;">
                    {% for section in section_list %}
                        <li class="list-group-item d-flex justify-content-between align-items-center border-0"
                            data-section-id="{{ section.id }}" data-section-type="{{ section.type }}">

                            <div class="d-flex align-items-center gap-2" style="flex:1; min-width:0;">
                                <span class="drag-handle me-2" aria-hidden="true" title="Перетащить">☰</span>

                                <button type="button"
                                        class="btn btn-link section-link text-decoration-none text-truncate p-0 me-2"
                                        data-section-id="{{ section.id }}">
                                    {{ section.name }}
                                </button>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>





    <div id="notification-container" class="position-fixed top-0 start-50 translate-middle-x mt-3" style="z-index: 1055;"></div>


    <!-- Инфо -->
    <div id="block-info" data-section-id="{{ section_id }}" data-is-admin="{{ is_admin }}" class="d-none"></div>

    <script>
        let sectionId = null;
        let isAdmin = null;

        document.addEventListener("DOMContentLoaded", () => {
            const infoBlock = document.querySelector("#block-info");
            if (infoBlock) {
                sectionId = infoBlock.dataset.sectionId;
                isAdmin = infoBlock.dataset.isAdmin == "True";
            } else {
                showNotification("Произошла ошибка. Вы не можете создавать задания.");
            }
        });
    </script>


    <!-- Компоненты редактирования -->
    {% include 'courses/editor/task_selection_modal.html' %}
    <script src="{% static 'component_editors/test.js' %}"></script>
    <script src="{% static 'component_editors/truefalse.js' %}"></script>
    <script src="{% static 'component_editors/note.js' %}"></script>
    <script src="{% static 'component_editors/match.js' %}"></script>
    <script src="{% static 'component_editors/image.js' %}"></script>
    <script src="{% static 'component_editors/fillgaps.js' %}"></script>
    <script src="{% static 'component_editors/textinput.js' %}"></script>


    <!-- JS-утилиты -->
    <script type="module" src="{% static 'utils/tasks_mapping.js' %}"></script>
    <script src="{% static 'utils/common_utils.js' %}"></script>
    <script src="{% static 'utils/editor_utils.js' %}"></script>
{% endblock %}
